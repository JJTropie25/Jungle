import React, { createContext, useContext, useMemo, useState } from "react";

export type Language = "en" | "it" | "es" | "zh";

type Translations = Record<Language, Record<string, string>>;

const translations: Translations = {
  en: {
    "tabs.home": "Home",
    "tabs.favourites": "Favourites",
    "tabs.bookings": "Bookings",
    "tabs.profile": "Profile",
    "bookings.title": "Your bookings",
    "bookings.empty": "No bookings yet.",
    "bookings.signIn": "Sign in to see your bookings.",
    "bookings.loading": "Loading bookings...",
    "favorites.title": "Your favourites",
    "favorites.empty": "No favourites yet.",
    "favorites.signIn": "Sign in to see favourites.",
    "favorites.loading": "Loading favourites...",

    "profile.editInfo": "Edit personal info",
    "profile.changeLanguage": "Change language",
    "profile.logout": "Logout",
    "profile.logoutSuccess": "Signed out.",

    "auth.signInTitle": "Welcome back",
    "auth.signInSubtitle": "Sign in to continue",
    "auth.signUpTitle": "Create account",
    "auth.signUpSubtitle": "Start using Jungle",
    "auth.username": "Username",
    "auth.email": "Email",
    "auth.password": "Password",
    "auth.signInAction": "Sign in",
    "auth.signUpAction": "Sign up",
    "auth.noAccount": "No account?",
    "auth.haveAccount": "Already have an account?",
    "auth.loading": "Loading...",
    "auth.checkEmail": "Check your email",
    "auth.checkEmailDetail": "Please confirm your email to complete sign up.",

    "edit.title": "Personal info",
    "edit.username": "Username",
    "edit.email": "Email",
    "edit.password": "Password",
    "edit.changePhoto": "Change photo",
    "edit.becomeHost": "Become a host",
    "edit.saveChanges": "Save changes",
    "edit.saved": "Profile updated.",
    "edit.photoPermissionDenied": "Photo permission denied.",
    "edit.photoError": "Unable to upload photo.",

    "language.title": "Language",
    "language.english": "English",
    "language.italian": "Italian",
    "language.spanish": "Spanish",
    "language.chinese": "Chinese (Mandarin)",

    "home.recentlyViewed": "Recently viewed",
    "home.aroundYou": "Around you",
    "home.search": "Search",
    "home.destination": "Destination",
    "home.date": "Date",
    "home.time": "Time",
    "home.people": "People",

    "category.rest": "Rest",
    "category.shower": "Shower",
    "category.storage": "Storage",

    "search.sort.priceUp": "Price Up",
    "search.sort.priceDown": "Price Down",
    "search.sort.topRated": "Top rated",
    "search.sort.nearest": "Nearest",
    "search.sort": "Sort",
    "search.filter": "Filter",
    "search.filter.all": "All",
    "search.filter.price": "Price",
    "search.filter.distance": "Distance",
    "search.filter.rating": "Rating",
    "search.map": "Map",
    "search.list": "List",
    "search.noResults": "No results",
    "search.maxPrice": "Max price: EUR {value}",
    "search.maxDistance": "Max distance: {value} km",
    "search.minRating": "Min rating: {value}",
    "label.rating": "Rating",
    "day.today": "Today",
    "day.tomorrow": "Tomorrow",
    "day.friday": "Friday",
    "day.weekend": "This weekend",

    "booking.thankYou": "Thank you for your booking",
    "booking.manageTitle": "Manage booking",
    "booking.accessQr": "Access with this QR code",
    "booking.qrCode": "QR CODE",
    "booking.getDirections": "Get directions",
    "booking.manage": "Manage booking",
    "booking.cancel": "Cancel booking",
    "booking.cancelConfirm": "Are you sure you want to cancel?",
    "booking.cancelYes": "Yes, cancel",
    "booking.cancelNo": "No",
    "booking.contact": "Contact the property",

    "service.availableTimes": "Available times",
    "service.bookNow": "Book now",
  },
  it: {
    "tabs.home": "Home",
    "tabs.favourites": "Preferiti",
    "tabs.bookings": "Prenotazioni",
    "tabs.profile": "Profilo",
    "bookings.title": "Le tue prenotazioni",
    "bookings.empty": "Nessuna prenotazione.",
    "bookings.signIn": "Accedi per vedere le tue prenotazioni.",
    "bookings.loading": "Caricamento prenotazioni...",
    "favorites.title": "I tuoi preferiti",
    "favorites.empty": "Nessun preferito.",
    "favorites.signIn": "Accedi per vedere i preferiti.",
    "favorites.loading": "Caricamento preferiti...",

    "profile.editInfo": "Modifica dati personali",
    "profile.changeLanguage": "Cambia lingua",
    "profile.logout": "Logout",
    "profile.logoutSuccess": "Logout effettuato.",

    "auth.signInTitle": "Bentornato",
    "auth.signInSubtitle": "Accedi per continuare",
    "auth.signUpTitle": "Crea un account",
    "auth.signUpSubtitle": "Inizia con Jungle",
    "auth.username": "Username",
    "auth.email": "Email",
    "auth.password": "Password",
    "auth.signInAction": "Accedi",
    "auth.signUpAction": "Registrati",
    "auth.noAccount": "Non hai un account?",
    "auth.haveAccount": "Hai gia un account?",
    "auth.loading": "Caricamento...",
    "auth.checkEmail": "Controlla la tua email",
    "auth.checkEmailDetail": "Conferma la tua email per completare la registrazione.",

    "edit.title": "Dati personali",
    "edit.username": "Username",
    "edit.email": "Email",
    "edit.password": "Password",
    "edit.changePhoto": "Cambia foto",
    "edit.becomeHost": "Diventa host",
    "edit.saveChanges": "Salva modifiche",
    "edit.saved": "Profilo aggiornato.",
    "edit.photoPermissionDenied": "Permesso foto negato.",
    "edit.photoError": "Impossibile caricare la foto.",

    "language.title": "Lingua",
    "language.english": "Inglese",
    "language.italian": "Italiano",
    "language.spanish": "Spagnolo",
    "language.chinese": "Cinese (Mandarino)",

    "home.recentlyViewed": "Visti di recente",
    "home.aroundYou": "Intorno a te",
    "home.search": "Cerca",
    "home.destination": "Destinazione",
    "home.date": "Data",
    "home.time": "Ora",
    "home.people": "Persone",

    "category.rest": "Riposo",
    "category.shower": "Doccia",
    "category.storage": "Deposito",

    "search.sort.priceUp": "Prezzo su",
    "search.sort.priceDown": "Prezzo giu",
    "search.sort.topRated": "Piu votati",
    "search.sort.nearest": "Piu vicini",
    "search.sort": "Ordina",
    "search.filter": "Filtra",
    "search.filter.all": "Tutti",
    "search.filter.price": "Prezzo",
    "search.filter.distance": "Distanza",
    "search.filter.rating": "Voto",
    "search.map": "Mappa",
    "search.list": "Lista",
    "search.noResults": "Nessun risultato",
    "search.maxPrice": "Prezzo max: EUR {value}",
    "search.maxDistance": "Distanza max: {value} km",
    "search.minRating": "Voto min: {value}",
    "label.rating": "Voto",
    "day.today": "Oggi",
    "day.tomorrow": "Domani",
    "day.friday": "Venerdi",
    "day.weekend": "Questo weekend",

    "booking.thankYou": "Grazie per la tua prenotazione",
    "booking.manageTitle": "Gestisci prenotazione",
    "booking.accessQr": "Accedi con questo QR code",
    "booking.qrCode": "QR CODE",
    "booking.getDirections": "Indicazioni",
    "booking.manage": "Gestisci prenotazione",
    "booking.cancel": "Annulla prenotazione",
    "booking.cancelConfirm": "Vuoi annullare la prenotazione?",
    "booking.cancelYes": "Si, annulla",
    "booking.cancelNo": "No",
    "booking.contact": "Contatta la struttura",

    "service.availableTimes": "Orari disponibili",
    "service.bookNow": "Prenota ora",
  },
  es: {
    "tabs.home": "Inicio",
    "tabs.favourites": "Favoritos",
    "tabs.bookings": "Reservas",
    "tabs.profile": "Perfil",
    "bookings.title": "Tus reservas",
    "bookings.empty": "Aun no hay reservas.",
    "bookings.signIn": "Inicia sesion para ver tus reservas.",
    "bookings.loading": "Cargando reservas...",
    "favorites.title": "Tus favoritos",
    "favorites.empty": "Aun no hay favoritos.",
    "favorites.signIn": "Inicia sesion para ver favoritos.",
    "favorites.loading": "Cargando favoritos...",

    "profile.editInfo": "Editar datos personales",
    "profile.changeLanguage": "Cambiar idioma",
    "profile.logout": "Cerrar sesion",
    "profile.logoutSuccess": "Sesion cerrada.",

    "auth.signInTitle": "Bienvenido",
    "auth.signInSubtitle": "Inicia sesion para continuar",
    "auth.signUpTitle": "Crear cuenta",
    "auth.signUpSubtitle": "Empieza con Jungle",
    "auth.username": "Usuario",
    "auth.email": "Email",
    "auth.password": "Contrasena",
    "auth.signInAction": "Iniciar sesion",
    "auth.signUpAction": "Registrarse",
    "auth.noAccount": "No tienes cuenta?",
    "auth.haveAccount": "Ya tienes cuenta?",
    "auth.loading": "Cargando...",
    "auth.checkEmail": "Revisa tu email",
    "auth.checkEmailDetail": "Confirma tu email para completar el registro.",

    "edit.title": "Datos personales",
    "edit.username": "Usuario",
    "edit.email": "Email",
    "edit.password": "Contrasena",
    "edit.changePhoto": "Cambiar foto",
    "edit.becomeHost": "Convertirse en anfitrion",
    "edit.saveChanges": "Guardar cambios",
    "edit.saved": "Perfil actualizado.",
    "edit.photoPermissionDenied": "Permiso de fotos denegado.",
    "edit.photoError": "No se pudo cargar la foto.",

    "language.title": "Idioma",
    "language.english": "Ingles",
    "language.italian": "Italiano",
    "language.spanish": "Espanol",
    "language.chinese": "Chino (Mandarin)",

    "home.recentlyViewed": "Vistos recientemente",
    "home.aroundYou": "Cerca de ti",
    "home.search": "Buscar",
    "home.destination": "Destino",
    "home.date": "Fecha",
    "home.time": "Hora",
    "home.people": "Personas",

    "category.rest": "Descanso",
    "category.shower": "Ducha",
    "category.storage": "Guardaequipaje",

    "search.sort.priceUp": "Precio arriba",
    "search.sort.priceDown": "Precio abajo",
    "search.sort.topRated": "Mejor valorados",
    "search.sort.nearest": "Mas cercanos",
    "search.sort": "Ordenar",
    "search.filter": "Filtrar",
    "search.filter.all": "Todos",
    "search.filter.price": "Precio",
    "search.filter.distance": "Distancia",
    "search.filter.rating": "Valoracion",
    "search.map": "Mapa",
    "search.list": "Lista",
    "search.noResults": "Sin resultados",
    "search.maxPrice": "Precio max: EUR {value}",
    "search.maxDistance": "Distancia max: {value} km",
    "search.minRating": "Valoracion min: {value}",
    "label.rating": "Valoracion",
    "day.today": "Hoy",
    "day.tomorrow": "Manana",
    "day.friday": "Viernes",
    "day.weekend": "Este fin de semana",

    "booking.thankYou": "Gracias por tu reserva",
    "booking.manageTitle": "Gestionar reserva",
    "booking.accessQr": "Accede con este QR",
    "booking.qrCode": "QR CODE",
    "booking.getDirections": "Como llegar",
    "booking.manage": "Gestionar reserva",
    "booking.cancel": "Cancelar reserva",
    "booking.cancelConfirm": "Deseas cancelar la reserva?",
    "booking.cancelYes": "Si, cancelar",
    "booking.cancelNo": "No",
    "booking.contact": "Contactar al alojamiento",

    "service.availableTimes": "Horarios disponibles",
    "service.bookNow": "Reservar ahora",
  },
  zh: {
    "tabs.home": "??",
    "tabs.favourites": "??",
    "tabs.bookings": "??",
    "tabs.profile": "??",
    "bookings.title": "????",
    "bookings.empty": "??????",
    "bookings.signIn": "??????????",
    "bookings.loading": "??????...",
    "favorites.title": "????",
    "favorites.empty": "??????",
    "favorites.signIn": "????????",
    "favorites.loading": "??????...",

    "profile.editInfo": "??????",
    "profile.changeLanguage": "????",
    "profile.logout": "????",
    "profile.logoutSuccess": "??????",

    "auth.signInTitle": "????",
    "auth.signInSubtitle": "?????",
    "auth.signUpTitle": "????",
    "auth.signUpSubtitle": "???? Jungle",
    "auth.username": "???",
    "auth.email": "??",
    "auth.password": "??",
    "auth.signInAction": "??",
    "auth.signUpAction": "??",
    "auth.noAccount": "?????",
    "auth.haveAccount": "?????",
    "auth.loading": "???...",
    "auth.checkEmail": "????",
    "auth.checkEmailDetail": "???????????",

    "edit.title": "????",
    "edit.username": "???",
    "edit.email": "??",
    "edit.password": "??",
    "edit.changePhoto": "????",
    "edit.becomeHost": "????",
    "edit.saveChanges": "????",
    "edit.saved": "??????",
    "edit.photoPermissionDenied": "????????",
    "edit.photoError": "???????",

    "language.title": "??",
    "language.english": "??",
    "language.italian": "????",
    "language.spanish": "????",
    "language.chinese": "???????",

    "home.recentlyViewed": "????",
    "home.aroundYou": "??",
    "home.search": "??",
    "home.destination": "???",
    "home.date": "??",
    "home.time": "??",
    "home.people": "??",

    "category.rest": "??",
    "category.shower": "??",
    "category.storage": "??",

    "search.sort.priceUp": "????",
    "search.sort.priceDown": "????",
    "search.sort.topRated": "????",
    "search.sort.nearest": "??",
    "search.sort": "??",
    "search.filter": "??",
    "search.filter.all": "??",
    "search.filter.price": "??",
    "search.filter.distance": "??",
    "search.filter.rating": "??",
    "search.map": "??",
    "search.list": "??",
    "search.noResults": "???",
    "search.maxPrice": "????: EUR {value}",
    "search.maxDistance": "????: {value} km",
    "search.minRating": "????: {value}",
    "label.rating": "??",
    "day.today": "??",
    "day.tomorrow": "??",
    "day.friday": "??",
    "day.weekend": "???",

    "booking.thankYou": "??????",
    "booking.manageTitle": "????",
    "booking.accessQr": "????????",
    "booking.qrCode": "???",
    "booking.getDirections": "??",
    "booking.manage": "????",
    "booking.cancel": "????",
    "booking.cancelConfirm": "?????????",
    "booking.cancelYes": "????",
    "booking.cancelNo": "?",
    "booking.contact": "????",

    "service.availableTimes": "????",
    "service.bookNow": "????",
  },
};

type I18nContextValue = {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, params?: Record<string, string | number>) => string;
};

const I18nContext = createContext<I18nContextValue | null>(null);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguage] = useState<Language>("en");

  const value = useMemo<I18nContextValue>(() => {
    const t = (key: string, params?: Record<string, string | number>) => {
      const dict = translations[language] ?? translations.en;
      let str = dict[key] ?? key;
      if (params) {
        for (const [k, v] of Object.entries(params)) {
          str = str.replace(new RegExp(`\{${k}\}`, "g"), String(v));
        }
      }
      return str;
    };
    return { language, setLanguage, t };
  }, [language]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error("useI18n must be used within I18nProvider");
  }
  return ctx;
}
